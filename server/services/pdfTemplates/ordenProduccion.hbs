<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Orden de Producci√≥n - {{proyecto.numero}}</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      font-size: 10pt;
      line-height: 1.4;
      color: #333;
      background: #fff;
    }

    .page {
      padding: 20px;
      max-width: 800px;
      margin: 0 auto;
    }

    /* HEADER */
    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding-bottom: 15px;
      border-bottom: 3px solid #D4AF37;
      margin-bottom: 20px;
    }

    .header-left h1 {
      font-size: 24pt;
      color: #000;
      font-weight: 700;
      margin-bottom: 5px;
    }

    .header-left p {
      font-size: 9pt;
      color: #666;
    }

    .header-right {
      text-align: right;
    }

    .orden-numero {
      font-size: 14pt;
      font-weight: 700;
      color: #D4AF37;
      margin-bottom: 5px;
    }

    .fecha {
      font-size: 9pt;
      color: #666;
    }

    /* SECCIONES */
    .section {
      margin-bottom: 20px;
      page-break-inside: avoid;
    }

    .section-title {
      font-size: 12pt;
      font-weight: 700;
      color: #000;
      background: #f5f5f5;
      padding: 8px 12px;
      border-left: 4px solid #D4AF37;
      margin-bottom: 10px;
    }

    .info-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 10px;
      margin-bottom: 15px;
    }

    .info-item {
      padding: 8px;
      background: #fafafa;
      border-left: 2px solid #ddd;
    }

    .info-label {
      font-size: 8pt;
      color: #666;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: 3px;
    }

    .info-value {
      font-size: 10pt;
      color: #000;
      font-weight: 600;
    }

    /* TABLAS */
    table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 15px;
    }

    th {
      background: #000;
      color: #D4AF37;
      font-size: 9pt;
      font-weight: 700;
      text-align: left;
      padding: 8px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    td {
      padding: 8px;
      border-bottom: 1px solid #e0e0e0;
      font-size: 9pt;
    }

    tr:nth-child(even) {
      background: #fafafa;
    }

    tr:hover {
      background: #f0f0f0;
    }

    /* PIEZA CARD */
    .pieza-card {
      border: 2px solid #D4AF37;
      padding: 15px;
      margin-bottom: 20px;
      page-break-inside: avoid;
      background: #fff;
    }

    .pieza-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
      padding-bottom: 10px;
      border-bottom: 2px solid #f0f0f0;
    }

    .pieza-numero {
      font-size: 16pt;
      font-weight: 700;
      color: #D4AF37;
    }

    .pieza-ubicacion {
      font-size: 12pt;
      color: #000;
      font-weight: 600;
    }

    .pieza-medidas {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 10px;
      margin-bottom: 15px;
      padding: 10px;
      background: #f9f9f9;
      border-radius: 4px;
    }

    .medida-item {
      text-align: center;
    }

    .medida-label {
      font-size: 8pt;
      color: #666;
      text-transform: uppercase;
    }

    .medida-value {
      font-size: 14pt;
      font-weight: 700;
      color: #000;
    }

    .medida-unit {
      font-size: 8pt;
      color: #999;
    }

    /* ESPECIFICACIONES T√âCNICAS */
    .specs-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 8px;
      margin-bottom: 15px;
    }

    .spec-item {
      padding: 6px;
      background: #fafafa;
      border-left: 2px solid #D4AF37;
    }

    .spec-label {
      font-size: 7pt;
      color: #666;
      text-transform: uppercase;
      margin-bottom: 2px;
    }

    .spec-value {
      font-size: 9pt;
      color: #000;
      font-weight: 600;
    }

    /* MATERIALES */
    .materiales-table {
      margin-top: 15px;
    }

    .materiales-table th {
      background: #333;
      color: #D4AF37;
    }

    /* BADGE */
    .badge {
      display: inline-block;
      padding: 3px 8px;
      border-radius: 3px;
      font-size: 8pt;
      font-weight: 600;
      text-transform: uppercase;
    }

    .badge-motorizado {
      background: #4CAF50;
      color: white;
    }

    .badge-manual {
      background: #666;
      color: white;
    }

    .badge-urgente {
      background: #f44336;
      color: white;
    }

    .badge-alta {
      background: #ff9800;
      color: white;
    }

    .badge-normal {
      background: #2196F3;
      color: white;
    }

    /* CHECKLIST */
    .checklist {
      list-style: none;
      padding: 0;
    }

    .checklist-item {
      padding: 8px;
      margin-bottom: 5px;
      background: #fafafa;
      border-left: 3px solid #ddd;
      display: flex;
      align-items: center;
    }

    .checklist-checkbox {
      width: 16px;
      height: 16px;
      border: 2px solid #666;
      margin-right: 10px;
      display: inline-block;
    }

    /* FOOTER */
    .footer {
      margin-top: 30px;
      padding-top: 15px;
      border-top: 2px solid #D4AF37;
    }

    .firmas {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 20px;
      margin-top: 40px;
    }

    .firma-box {
      text-align: center;
    }

    .firma-line {
      border-top: 2px solid #000;
      margin-bottom: 5px;
    }

    .firma-label {
      font-size: 8pt;
      color: #666;
      text-transform: uppercase;
    }

    /* OBSERVACIONES */
    .observaciones-box {
      padding: 12px;
      background: #fff9e6;
      border-left: 4px solid #D4AF37;
      margin-bottom: 15px;
    }

    .observaciones-title {
      font-size: 9pt;
      font-weight: 700;
      color: #000;
      margin-bottom: 5px;
    }

    .observaciones-text {
      font-size: 9pt;
      color: #333;
      line-height: 1.5;
    }

    /* RESUMEN */
    .resumen-box {
      background: #f5f5f5;
      padding: 15px;
      border-radius: 4px;
      margin-bottom: 20px;
    }

    .resumen-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 15px;
    }

    .resumen-item {
      text-align: center;
    }

    .resumen-value {
      font-size: 18pt;
      font-weight: 700;
      color: #D4AF37;
    }

    .resumen-label {
      font-size: 8pt;
      color: #666;
      text-transform: uppercase;
      margin-top: 3px;
    }

    /* PAGE BREAK */
    .page-break {
      page-break-after: always;
    }

    /* PRINT */
    @media print {
      body {
        font-size: 9pt;
      }
      
      .page {
        padding: 10px;
      }

      .page-break {
        page-break-after: always;
      }
    }
  </style>
</head>
<body>
  <div class="page">
    <!-- HEADER -->
    <div class="header">
      <div class="header-left">
        <h1>üõ†Ô∏è ORDEN DE PRODUCCI√ìN</h1>
        <p>{{company.name}} | {{company.phone}}</p>
      </div>
      <div class="header-right">
        <div class="orden-numero">{{proyecto.numero}}</div>
        <div class="fecha">{{formatDate generadoEn}}</div>
        {{#if proyecto.prioridad}}
          {{#eq proyecto.prioridad "urgente"}}
            <span class="badge badge-urgente">URGENTE</span>
          {{/eq}}
          {{#eq proyecto.prioridad "alta"}}
            <span class="badge badge-alta">ALTA</span>
          {{/eq}}
          {{#eq proyecto.prioridad "normal"}}
            <span class="badge badge-normal">NORMAL</span>
          {{/eq}}
        {{/if}}
      </div>
    </div>

    <!-- INFORMACI√ìN DEL CLIENTE -->
    <div class="section">
      <div class="section-title">üìã INFORMACI√ìN DEL CLIENTE</div>
      <div class="info-grid">
        <div class="info-item">
          <div class="info-label">Cliente</div>
          <div class="info-value">{{cliente.nombre}}</div>
        </div>
        <div class="info-item">
          <div class="info-label">Tel√©fono</div>
          <div class="info-value">{{cliente.telefono}}</div>
        </div>
        <div class="info-item" style="grid-column: span 2;">
          <div class="info-label">Direcci√≥n</div>
          <div class="info-value">{{cliente.direccion}}</div>
        </div>
        {{#if cliente.referencias}}
        <div class="info-item" style="grid-column: span 2;">
          <div class="info-label">Referencias</div>
          <div class="info-value">{{cliente.referencias}}</div>
        </div>
        {{/if}}
      </div>
    </div>

    <!-- RESUMEN DEL PROYECTO -->
    <div class="resumen-box">
      <div class="resumen-grid">
        <div class="resumen-item">
          <div class="resumen-value">{{totalPiezas}}</div>
          <div class="resumen-label">Piezas Totales</div>
        </div>
        <div class="resumen-item">
          <div class="resumen-value">{{cronograma.diasEstimados}}</div>
          <div class="resumen-label">D√≠as Estimados</div>
        </div>
        <div class="resumen-item">
          <div class="resumen-value">{{formatDate cronograma.fechaInicioFabricacion}}</div>
          <div class="resumen-label">Inicio</div>
        </div>
        <div class="resumen-item">
          <div class="resumen-value">{{formatDate cronograma.fechaFinEstimada}}</div>
          <div class="resumen-label">Entrega Estimada</div>
        </div>
      </div>
    </div>

    <!-- OBSERVACIONES GENERALES -->
    {{#if observaciones}}
    <div class="observaciones-box">
      <div class="observaciones-title">‚ö†Ô∏è OBSERVACIONES GENERALES</div>
      <div class="observaciones-text">{{observaciones}}</div>
    </div>
    {{/if}}

    {{#if observacionesFabricacion}}
    <div class="observaciones-box">
      <div class="observaciones-title">üîß INSTRUCCIONES DE FABRICACI√ìN</div>
      <div class="observaciones-text">{{observacionesFabricacion}}</div>
    </div>
    {{/if}}
  </div>

  <!-- PIEZAS (1-3 por p√°gina) -->
  {{#each piezas}}
  {{#if @index}}
    {{#if (eq (modulo @index 3) 0)}}
      <div class="page-break"></div>
      <div class="page">
    {{/if}}
  {{/if}}

  <div class="pieza-card">
    <!-- HEADER DE PIEZA -->
    <div class="pieza-header">
      <div>
        <span class="pieza-numero">PIEZA #{{numero}}</span>
        <div class="pieza-ubicacion">{{ubicacion}}</div>
      </div>
      <div>
        {{#if motorizado}}
          <span class="badge badge-motorizado">‚ö° MOTORIZADO</span>
        {{else}}
          <span class="badge badge-manual">MANUAL</span>
        {{/if}}
      </div>
    </div>

    <!-- MEDIDAS -->
    <div class="pieza-medidas">
      <div class="medida-item">
        <div class="medida-label">Ancho</div>
        <div class="medida-value">{{formatNumber ancho 2}}<span class="medida-unit">m</span></div>
      </div>
      <div class="medida-item">
        <div class="medida-label">Alto</div>
        <div class="medida-value">{{formatNumber alto 2}}<span class="medida-unit">m</span></div>
      </div>
      <div class="medida-item">
        <div class="medida-label">√Årea</div>
        <div class="medida-value">{{formatNumber area 2}}<span class="medida-unit">m¬≤</span></div>
      </div>
    </div>

    <!-- ESPECIFICACIONES T√âCNICAS (13 CAMPOS) -->
    <div class="section-title" style="font-size: 10pt; margin-bottom: 10px;">üîß ESPECIFICACIONES T√âCNICAS</div>
    <div class="specs-grid">
      <div class="spec-item">
        <div class="spec-label">Sistema</div>
        <div class="spec-value">{{sistema}}</div>
      </div>
      <div class="spec-item">
        <div class="spec-label">Control</div>
        <div class="spec-value">{{control}}</div>
      </div>
      <div class="spec-item">
        <div class="spec-label">Producto</div>
        <div class="spec-value">{{producto}}</div>
      </div>
      <div class="spec-item">
        <div class="spec-label">Modelo</div>
        <div class="spec-value">{{modelo}}</div>
      </div>
      <div class="spec-item">
        <div class="spec-label">Color</div>
        <div class="spec-value">{{color}}</div>
      </div>
      <div class="spec-item">
        <div class="spec-label">Tipo Instalaci√≥n</div>
        <div class="spec-value">{{tipoInstalacion}}</div>
      </div>
      <div class="spec-item">
        <div class="spec-label">Tipo Fijaci√≥n</div>
        <div class="spec-value">{{tipoFijacion}}</div>
      </div>
      <div class="spec-item">
        <div class="spec-label">Ca√≠da</div>
        <div class="spec-value">{{caida}}</div>
      </div>
      <div class="spec-item">
        <div class="spec-label">Galer√≠a</div>
        <div class="spec-value">{{galeria}}</div>
      </div>
      <div class="spec-item">
        <div class="spec-label">Base/Tabla</div>
        <div class="spec-value">{{baseTabla}}</div>
      </div>
      <div class="spec-item">
        <div class="spec-label">Modo Operaci√≥n</div>
        <div class="spec-value">{{modoOperacion}}</div>
      </div>
      <div class="spec-item">
        <div class="spec-label">Traslape</div>
        <div class="spec-value">{{traslape}}</div>
      </div>
      <div class="spec-item">
        <div class="spec-label">Modelo/C√≥digo</div>
        <div class="spec-value">{{modeloCodigo}}</div>
      </div>
    </div>

    {{#if observacionesTecnicas}}
    <div class="spec-item" style="grid-column: span 3; margin-top: 5px;">
      <div class="spec-label">Observaciones T√©cnicas</div>
      <div class="spec-value">{{observacionesTecnicas}}</div>
    </div>
    {{/if}}

    <!-- MATERIALES DE LA PIEZA -->
    <div class="section-title" style="font-size: 10pt; margin-top: 15px; margin-bottom: 10px;">üì¶ MATERIALES (BOM)</div>
    <table class="materiales-table">
      <thead>
        <tr>
          <th style="width: 20%;">Tipo</th>
          <th style="width: 35%;">Descripci√≥n</th>
          <th style="width: 15%;">Cantidad</th>
          <th style="width: 10%;">Unidad</th>
          <th style="width: 20%;">Observaciones</th>
        </tr>
      </thead>
      <tbody>
        {{#each materiales}}
        <tr>
          <td><strong>{{tipo}}</strong></td>
          <td>{{descripcion}}</td>
          <td style="text-align: right;"><strong>{{cantidad}}</strong></td>
          <td>{{unidad}}</td>
          <td style="font-size: 8pt; color: #666;">{{observaciones}}</td>
        </tr>
        {{/each}}
      </tbody>
    </table>
  </div>

  {{#if (eq (modulo (add @index 1) 3) 0)}}
    </div>
  {{/if}}
  {{/each}}

  <!-- Cerrar √∫ltima p√°gina si no se cerr√≥ -->
  {{#unless (eq (modulo piezas.length 3) 0)}}
    </div>
  {{/unless}}

  <!-- P√ÅGINA FINAL: MATERIALES CONSOLIDADOS -->
  <div class="page-break"></div>
  <div class="page">
    <!-- MATERIALES TOTALES -->
    <div class="section">
      <div class="section-title">üìä MATERIALES TOTALES DEL PROYECTO</div>
      <table>
        <thead>
          <tr>
            <th style="width: 20%;">Tipo</th>
            <th style="width: 40%;">Descripci√≥n</th>
            <th style="width: 15%;">Cantidad Total</th>
            <th style="width: 10%;">Unidad</th>
            <th style="width: 15%;">Observaciones</th>
          </tr>
        </thead>
        <tbody>
          {{#each materialesConsolidados}}
          <tr>
            <td><strong>{{tipo}}</strong></td>
            <td>{{descripcion}}</td>
            <td style="text-align: right; font-weight: 700; font-size: 11pt;">{{cantidad}}</td>
            <td><strong>{{unidad}}</strong></td>
            <td style="font-size: 8pt; color: #666;">{{observaciones}}</td>
          </tr>
          {{/each}}
        </tbody>
      </table>
    </div>

    <!-- CHECKLIST DE EMPAQUE -->
    <div class="section">
      <div class="section-title">‚úÖ CHECKLIST DE EMPAQUE Y CONTROL DE CALIDAD</div>
      <ul class="checklist">
        {{#each checklistEmpaque}}
        <li class="checklist-item">
          <span class="checklist-checkbox"></span>
          {{item}}
        </li>
        {{/each}}
      </ul>
    </div>

    <!-- FIRMAS -->
    <div class="footer">
      <div class="firmas">
        <div class="firma-box">
          <div class="firma-line"></div>
          <div class="firma-label">Responsable de Fabricaci√≥n</div>
        </div>
        <div class="firma-box">
          <div class="firma-line"></div>
          <div class="firma-label">Control de Calidad</div>
        </div>
        <div class="firma-box">
          <div class="firma-line"></div>
          <div class="firma-label">Coordinador de Producci√≥n</div>
        </div>
      </div>

      <div style="text-align: center; margin-top: 30px; font-size: 8pt; color: #999;">
        <p>Documento generado el {{formatDate generadoEn}} por {{generadoPor}}</p>
        <p>{{company.name}} | {{company.address}} | {{company.phone}}</p>
      </div>
    </div>
  </div>
</body>
</html>
